## File       : psid_data.R ####
## Description: ETL of Data 

# Variable List -----------------------------------------------------------
# CH02PRWT: CHILD LEVEL WEIGHT 02
# CH07PRWT: PRIMARY CAREGIVER / CHILD WEIGHT 07
# CH07WT: CHILD INTERVIEW / CHILD WEIGHT 07
# CH97HHWT: HOUSEHOLD LEVEL WEIGHT
# CH97PRWT: CHILD LEVEL WEIGHT
# ER10040: A23A TYPE MORTGAGE MOR 1
# ER10041: A23A TYPE MORTGAGE MOR 2
# ER10042: A23B WTR REFINANCED MTG1
# ER10043: A23B WTR REFINANCED MTG2
# ER10044: A24 REM PRINCIPAL MOR 1
# ER10045: A24 REM PRINCIPAL MOR 2
# ER10046: A25 MNTHLY PMTS MOR 1
# ER10047: A25 MNTHLY PMTS MOR 2
# ER10048: A25B CURR INT RATE MOR 1
# ER10049: A25B CURR INT RATE MOR 2
# ER10050: A25C MOR 1
# ER10051: A25C MOR 2
# ER10052: A26 YRS PAYING MOR 1
# ER10053: A26 YRS PAYING MOR 2
# ER10054: A27 YRS TO PAY MOR 1
# ER10055: A27 YRS TO PAY MOR 2
# ER10056: A28 2ND MORTGAGE
# ER10057: A28 3RD MORTGAGE
# ER10058: A29 MTG INCL PROP TAXES
# ER10060: A31 DOLLARS RENT
# ER12085: B9-9A MAIN OCCUPATION: 3 DIGIT (HD-E)
# ER12086: B10 MAIN INDUSTRY: 3 DIGIT (HD-E)
# ER12152: K10-10A OCCUPATION OF FATHER
# ER12154: K20-20A OCCUPATION OF MOTHER
# ER21049: A23A TYPE MORTGAGE MOR 1
# ER21050: A23B WTR ORIGINAL LOAN/REFINANCED #1
# ER21051: A24 REM PRINCIPAL MOR 1
# ER21052: ACCURACY OF REMAINING MORTGAGE PRIN #1
# ER21053: A25 MNTHLY PMTS MOR 1
# ER21054: ACCURACY OF MONTHLY PYMNTS ON MTGE #1
# ER21055: A25A CURR INTEREST RATE WHOLE PERCENT #1
# ER21056: A25A CURR INT RATE DECIMAL FRACTION #1
# ER21057: A26 YEAR OBTAINED LOAN #1
# ER21058: A27 YRS TO PAY MOR 1
# ER21059: A28 2ND MORTGAGE
# ER21060: A23A TYPE MORTGAGE MOR 2
# ER21061: A23B WTR ORIGINAL LOAN/REFINANCED #2
# ER21062: A24 REM PRINCIPAL MOR 2
# ER21063: ACCURACY OF REMAINING MORTGAGE PRIN #2
# ER21064: A25 MNTHLY PMTS MOR 2
# ER21065: ACCURACY OF MONTHLY PYMNTS ON MTGE #2
# ER21066: A25A CURR INTEREST RATE WHOLE PERCENT #2
# ER21067: A25A CURR INT RATE DECIMAL FRACTION #2
# ER21068: A26 YEAR OBTAINED LOAN #2
# ER21069: A27 YRS TO PAY MOR 2
# ER21070: A29 MTG INCL PROP TAXES
# ER21072: A31 DOLLARS RENT
# ER21145: BC20 MAIN OCC FOR JOB 1: 2000 CODE (HD)
# ER21146: BC21 MAIN IND FOR JOB 1: 2000 CODE (HD)
# ER22621: W38 WTR OTHER DEBTS
# ER23311: K10-10A OCCUPATION OF FATHER
# ER23320: K20-20A OCCUPATION OF MOTHER
# ER23703: R1 WTR RECD ST/LOCL WELFARE YR B4 LAST
# ER23704: R5 WELFARE AMT
# ER30001: 1968 INTERVIEW NUMBER
# ER30002: PERSON NUMBER 68
# ER31996: SAMPLING ERROR STRATUM
# ER31997: SAMPLING ERROR CLUSTER
# ER32021: YEAR BIRTH INFO MOST RECENTLY UPDATED
# ER32022: # LIVE BIRTHS TO THIS INDIVIDUAL
# ER32024: YEAR 1ST/ONLY CHILD BORN
# ER32026: YEAR YOUNGEST CHILD BORN
# ER32028: YEAR 2ND YOUNGEST CHILD BORN
# ER32030: YEAR 3RD YOUNGEST CHILD BORN
# ER32032: YEAR 4TH YOUNGEST CHILD BORN
# ER33401: 1997 INTERVIEW NUMBER
# ER33402: SEQUENCE NUMBER 97
# ER33403: RELATION TO HEAD 97
# ER33601: 2001 INTERVIEW NUMBER
# ER33602: SEQUENCE NUMBER 01
# ER33603: RELATION TO HEAD 01
# ER33701: 2003 INTERVIEW NUMBER
# ER33702: SEQUENCE NUMBER 03
# ER33703: RELATION TO HEAD 03
# ER33901: 2007 INTERVIEW NUMBER
# ER33902: SEQUENCE NUMBER 07
# ER33903: RELATION TO HEAD 07
# ER36040: A23A TYPE MORTGAGE MOR 1
# ER36041: A23B WTR ORIGINAL LOAN/REFINANCED #1
# ER36042: A24 REM PRINCIPAL MOR 1
# ER36043: ACCURACY OF REMAINING MORTGAGE PRIN #1
# ER36044: A25 MNTHLY PMTS MOR 1
# ER36045: ACCURACY OF MONTHLY PYMNTS ON MTGE #1
# ER36046: A25A CURR INTEREST RATE WHOLE PERCENT #1
# ER36047: A25A CURR INT RATE DECIMAL FRACTION #1
# ER36048: A25A1 WTR CURR INT RATE FIXED/VARBLE #1
# ER36049: A26 YEAR OBTAINED LOAN #1
# ER36050: A27 YRS TO PAY MOR 1
# ER36051: A28 2ND MORTGAGE
# ER36052: A23A TYPE MORTGAGE MOR 2
# ER36053: A23B WTR ORIGINAL LOAN/REFINANCED #2
# ER36054: A24 REM PRINCIPAL MOR 2
# ER36055: ACCURACY OF REMAINING MORTGAGE PRIN #2
# ER36056: A25 MNTHLY PMTS MOR 2
# ER36057: ACCURACY OF MONTHLY PYMNTS ON MTGE #2
# ER36058: A25A CURR INTEREST RATE WHOLE PERCENT #2
# ER36059: A25A CURR INT RATE DECIMAL FRACTION #2
# ER36060: A25A1 WTR CURR INT RATE FIXED/VARBLE #2
# ER36061: A26 YEAR OBTAINED LOAN #2
# ER36062: A27 YRS TO PAY MOR 2
# ER36063: A29 MTG INCL PROP TAXES
# ER36065: A31 DOLLARS RENT
# ER37620: W38 WTR OTHER DEBTS
# ER37725: W134 EARNINGS EXPECTATIONS FOR CHILD--1
# ER37726: W134 EARNINGS EXPECTATIONS FOR CHILD--2
# ER37727: W134 EARNINGS EXPECTATIONS FOR CHILD--3
# ER40458: K21 INDUSTRY OF MOTHER-WF
# ER40536: L10-10A OCCUPATION OF FATHER-HD
# ER40779: R41 WTR RECD TANF (ADC) YR B4 LAST
# OCGCHBWT: OCG - CHILD BOOKLET WEIGHT
# OCGHHBWT: OCG - HOUSEHOLD BOOKLET WEIGHT
# PCGHHBWT: PCG - HOUSEHOLD BOOKLET WEIGHT
# Q1A19: OTHER HELP-PREGNANT 97
# Q1A33: AMT-MEDICAL CARE 97
# Q1E12A: HOW MUCH ALLOWANCE 97
# Q1F12A: HOW MUCH ALLOWANCE 97
# Q1G11C: SCH COSTS PREV YR-AMT 97
# Q1G21: EXPECTED EDUC 97
# Q1K10: NOT EAT FOR A DAY-NO $$ FOR FOOD 97
# Q1K3A: FOOD RUN OUT BEFORE GET $$ 97
# Q1K3B: NOT ENOUGH $$ FOR MORE FOOD 97
# Q1K7: EAT LESS-NO $$ FOR FOOD 97
# Q1K8: HUNGRY DIDN'T EAT-NO $$ FOR FOOD 97
# Q1K9: LOSE WEIGHT-NO $$ FOR FOOD 97
# Q21A19: AMT -DENTAL CARE 02
# Q21A20_2: AMT - OUTSIDE HH PAY DENTAL CARE 02
# Q21A23: AMT -MEDICAL CARE 02
# Q21A24_2: AMT - OUTSIDE HH PAY MEDICAL CARE 02
# Q21B1: PREFERRED EDUC 02
# Q21B11A1: CURR SCH COSTS - AMT 02
# Q21B12A1: SCH COSTS PREV YR - AMT 02
# Q21B2: EXPECTED EDUC 02
# Q21C10H: WKDAY:EXTRA-CURRIC ACTIVITIES 02
# Q21C15A: WKDAY: COST OF CARE - AMT 02
# Q21C15B: WKDAY: COST OF CARE - UNIT 02
# Q21C21A: WKDAY 2: COST OF CARE - AMT 02
# Q21C21B: WKDAY 2: COST OF CARE - UNIT 02
# Q21C22H: WKEND:EXT-CURRIC ACTIVITIES 02
# Q21C27A: WKEND: COST OF CARE - AMT 02
# Q21C27B: WKEND: COST OF CARE - UNIT 02
# Q21C28H: SUMMER:EXT-CURRIC ACTIVITIES 02
# Q21C33A: SUMMER: COST OF CARE - AMT 02
# Q21C33B: SUMMER: COST OF CARE - UNIT 02
# Q21C39A: SUMMER 2: COST OF CARE - AMT 02
# Q21C39B: SUMMER 2: COST OF CARE - UNIT 02
# Q21C7A_1: COSTS OF 1ST CARE PRE K - AMT 02
# Q21C7A_2: COSTS OF 2ND CARE PRE K - AMT 02
# Q21C7A_3: COSTS OF 3RD CARE PRE K - AMT 02
# Q21C7A_4: COSTS OF 4TH CARE PRE K - AMT 02
# Q21C7B_1: COSTS OF 1ST CARE PRE K - UNIT 02
# Q21C7B_2: COSTS OF 2ND CARE PRE K - UNIT 02
# Q21C7B_3: COSTS OF 3RD CARE PRE K - UNIT 02
# Q21C7B_4: COSTS OF 4TH CARE PRE K - UNIT 02
# Q21G10C: COST OF COMMUNITY GRPS 6-9 YRS 02
# Q21G21A1: ALLOWANCE - AMT 6-9 YRS 02
# Q21G21A2: ALLOWANCE - PER 6-9 YRS 02
# Q21G5D: COST OF TUTORING 6-9 YRS 02
# Q21H22B: ALLOWANCE - AMT 10+ YRS 02
# Q21H22C: ALLOWANCE - PER 10+ YRS 02
# Q21H23A1: AMT SPENT ON TOYS 02
# Q21H23B1: AMT SPENT OF VACATION 02
# Q21H23C1: AMT SPENT OF SCH SUPPLIES 02
# Q21H23D1: AMT SPENT ON CLOTHES 02
# Q21H23E1: AMT SPENT ON CAR INSUR 02
# Q21H23F1: AMT SPENT ON CAR PAYMTS 02
# Q21H23G1: AMT SPENT ON CAR MAINTENANCE 02
# Q21H23H1: AMT SPENT ON FOOD 02
# Q21H24J: ABSENT DAD SPEND ON ALLOWANCE 02
# Q21H24O: ABSENT DAD SPEND ON EXTRA-CURRICULAR 02
# Q21H25J: ABSENT MOM SPEND ON ALLOWANCE 02
# Q21H25O: ABSENT DAD SPEND ON EXTRA-CURRICULAR 02
# Q21H5C: COST OF TUTORING 10+ YRS 02
# Q21H8B: COST OF COMMUNITY GRPS 10+ YRS 02
# Q23L10: SCHOOL EXPECTATIONS 02
# Q23L10A: DEGREE EXPECTATIONS 02
# Q23L2: ALLOWANCE: AMT 02
# Q23L2A: ALLOWANCE: UNIT 02
# Q23L4A5: PAY CLOTHES 02
# Q24APPR: APPLIED PROB PERCENTILE RANK 02
# Q24BRPR: BROAD READING PERCENTILE RANK 02
# Q24LWPR: LW PERCENTILE RANK 02
# Q24PCPR: PC PERCENTILE RANK 02
# Q2A51: $$ SPENT ON MED CARE & INSUR 97
# Q31B1: PREFERRED EDUCATION 07
# Q31B11A1: CURR SCHOOL COSTS - AMT 07
# Q31B11A2: CURR SCHOOL COSTS - PER 07
# Q31B12A1: PREV YR SCHOOL COSTS - AMT 07
# Q31B12A2: PREV YR SCHOOL COSTS - PER 07
# Q31B2: EXPECTED EDUCATION 07
# Q31C15A: WKDAY: COST OF CARE - AMT 07
# Q31C15B: WKDAY: COST OF CARE - UNIT 07
# Q31C21A: CWKDAY 2: COST OF CARE - AMT 07
# Q31C21B: WKDAY 2: COST OF CARE - UNIT 07
# Q31C27A: WKEND: COST OF CARE - AMT 07
# Q31C27B: WKEND: COST OF CARE - UNIT 07
# Q31C33A: SUMMER: COST OF CARE - AMT 07
# Q31C33B: SUMMER: COST OF CARE - UNIT 07
# Q31C39A: SUMMER 2: COST OF CARE - AMT 07
# Q31C39B: SUMMER 2: COST OF CARE - UNIT 07
# Q31H22B: ALLOWANCE - AMT 10+ YRS 07
# Q31H22C: ALLOWANCE - PER 10+ YRS 07
# Q31H23A1: AMT SPENT ON TOYS 07
# Q31H23B1: AMT SPENT ON VACATION 07
# Q31H23C1: AMT SPENT ON SCHOOL SUPPLIES 07
# Q31H23D1: AMT SPENT ON CLOTHES 07
# Q31H23E1: AMT SPENT ON CAR INSURANCE 07
# Q31H23F1: AMT SPENT ON CAR PAYMENTS 07
# Q31H23G1: AMT SPENT ON CAR MAINTENANCE 07
# Q31H5C: COST OF TUTORING 10+ YRS 07
# Q31H8B: COST OF COMM GRPS 10+ YRS 07
# Q32JA34: CHILDREN HEALTH OUT OF POCKET COSTS 07
# Q33L10: SCHOOL EXPECTATIONS 07
# Q33L10A: DEGREE EXPECTATIONS 07
# Q33L2: ALLOWANCE: AMT 07
# Q33L2A: ALLOWANCE: UNIT 07
# Q33L3F: PAST WK $ FOOD/DRINKS AT SCHOOL 07
# Q33L3G: PAST WK $ FAST FOOD/RESTAURANTS 07
# Q33L3H: PAST WK $ ALL OTH FOOD 07
# Q34APPR: APPLIED PROB PERCENTILE RANK 07
# Q34BRPR: BROAD READING PERCENTILE RANK 07
# Q34LWPR: LW PERCENTILE RANK 07
# Q34PCPR: PC PERCENTILE RANK 07
# Q3APPR: APPLIED PROB PERCENTILE RANK 97
# Q3BMPR: BROAD MATH PERCENTILE RANK 97
# Q3BRPR: BROAD READING PERCENTILE RANK 97
# Q3CALPR: CAL PERCENTILE RANK 97
# Q3LWPR: LW PERCENTILE RANK 97
# Q3PCPR: PC PERCENTILE RANK 97
# S606: IMP WTR OTH DEBT (W38) 03
# S620: IMP VALUE HOME EQUITY 03
# S806: IMP WTR OTH DEBT (W38) 07
# S820: IMP VALUE HOME EQUITY 07
# SUBSELWT: WITHIN HOUSEHOLD SELECTION FACTOR 

# Load Raw Data -----------------------------------------------------------
# Read in custom PSID Excel Spreadsheet
psid.data     <- read.csv("J195615.csv") #CSV saved from Excel version for speed

# Read in corresponding variable labels
#CSV cleaned and saved from .txt version:
psid.labels           <- read.csv("J195615_labels.csv", header = F) 
colnames(psid.labels) <- c("varname", "desc")
psid.labels[, 1]      <- trim(psid.labels[, 1])
psid.labels[, 2]      <- trim(psid.labels[, 2])

# Read in CDS Map: Excel Spreadsheet
cdsMap.data   <- read.csv("M195615.csv", header = T) #CSV saved from .xlsx

# Read in CDS Map: Variable Labels
#CSV cleaned and saved from .txt version:
cdsMap.labels <- read.csv("M195615_labels.csv", header = F) 
colnames(cdsMap.labels) <- c("varname", "desc")
cdsMap.labels[, 1]      <- trim(cdsMap.labels[, 1])
cdsMap.labels[, 2]      <- trim(cdsMap.labels[, 2])

# Save as RDS
saveRDS(psid.data,     "psid_data.RDS")
saveRDS(psid.labels,   "psid_labels.RDS")
saveRDS(cdsMap.data,   "cdsMap_data.RDS")
saveRDS(cdsMap.labels, "cdsMap_labels.RDS")

# Create Yearly Data Frames -----------------------------------------------
# Create Vectors for Variable Names by Year
list68 <- c("ER30001",	"ER30002",	"ER31996",	"ER31997",	"ER32021",	
            "ER32022",	"ER32024",	"ER32026",	"ER32028",	"ER32030",	
            "ER32032")
list97 <- c("ER10040",	"ER10041",	"ER10042",	"ER10043",	"ER10044",	
            "ER10045",	"ER10046",	"ER10047",	"ER10048",	"ER10049",	
            "ER10050",	"ER10051",	"ER10052",	"ER10053",	"ER10054",	
            "ER10055",	"ER10056",	"ER10057",	"ER10058",	"ER10060",	
            "ER12085",	"ER12086",	"ER12152",	"ER12154",	"ER33401",	
            "ER33402",	"ER33403",	"CH97PRW",	"CH97HHW",	"PCGHHBW",	
            "OCGCHBW",	"OCGHHBW",	"SUBSELW",	"Q1A19",	"Q1A33",	"Q1E12A",	
            "Q1F12A",	"Q1G11C",	"Q1G21",	"Q1K3A",	"Q1K3B",	"Q1K7",	"Q1K8",	
            "Q1K9",	"Q1K10",	"Q2A51",	"Q3LWPR",	"Q3PCPR",	"Q3BRPR",	
            "Q3CALPR",	"Q3APPR",	"Q3BMPR")
list01 <- c("ER33601", "ER33602",	"ER33603")
list02 <- c("CH02PRW",	"Q21A19",	"Q21A20_2",	"Q21A23",	  "Q21A24_2",	"Q21B1",	
            "Q21B2",	"Q21B11A1",	"Q21B12A1",	"Q21C7A_1",	"Q21C7A_2",	"Q21C7A_3",	
            "Q21C7A_4",	"Q21C7B_1",	"Q21C7B_2",	"Q21C7B_3",	"Q21C7B_4",	"Q21C10H",	
            "Q21C15A",	"Q21C15B",	"Q21C21A",	"Q21C21B",	"Q21C22H",	"Q21C27A",	
            "Q21C27B",	"Q21C28H",	"Q21C33A",	"Q21C33B",	"Q21C39A",	"Q21C39B",	
            "Q21G5D",	  "Q21G10C",	"Q21G21A1",	"Q21G21A2",	"Q21H5C",	"Q21H8B",	
            "Q21H22B",	"Q21H22C",	"Q21H23A1",	"Q21H23B1",	"Q21H23C1",	"Q21H23D1",	
            "Q21H23E1",	"Q21H23F1",	"Q21H23G1",	"Q21H23H1",	"Q21H24J",	"Q21H24O",	
            "Q21H25J",	"Q21H25O",	"Q23L2",	   "Q23L2A",	"Q23L4A5",	"Q23L10",	
            "Q23L10A",	"Q24LWPR",	"Q24PCPR",	"Q24BRPR",	"Q24APPR")
list03 <- c("ER21049",	"ER21050",	"ER21051",	"ER21052",	"ER21053",	"ER21054",	
            "ER21055",	"ER21056",	"ER21057",	"ER21058",	"ER21059",	"ER21060",	
            "ER21061",	"ER21062",	"ER21063",	"ER21064",	"ER21065",	"ER21066",	
            "ER21067",	"ER21068",	"ER21069",	"ER21070",	"ER21072",	"ER21145",	
            "ER21146",	"ER22621",	"ER23311",	"ER23320",	"ER23703",	"ER23704",	
            "S606",	"S620",	"ER33701",	"ER33702",	"ER33703")
list07 <- c("ER36040",	"ER36041",	"ER36042",	"ER36043",	"ER36044",	"ER36045",	
            "ER36046",	"ER36047",	"ER36048",	"ER36049",	"ER36050",	"ER36051",	
            "ER36052",	"ER36053",	"ER36054",	"ER36055",	"ER36056",	"ER36057",	
            "ER36058",	"ER36059",	"ER36060",	"ER36061",	"ER36062",	"ER36063",	
            "ER36065",	"ER37620",	"ER37725",	"ER37726",	"ER37727",	"ER40458",	
            "ER40536",	"ER40779",	"S806",	    "S820",	    "ER33901",	"ER33902",	
            "ER33903",	"CH07PRW",	"CH07WT",	  "Q31B1",	  "Q31B2",	  "Q31B11A",	
            "Q31B11A",	"Q31B12A",	"Q31B12A",	"Q31C15A",	"Q31C15B",	"Q31C21A",	
            "Q31C21B",	"Q31C27A",	"Q31C27B",	"Q31C33A",	"Q31C33B",	"Q31C39A",	
            "Q31C39B",	"Q31H5C",	  "Q31H8B",	  "Q31H22B",	"Q31H22C",	"Q31H23A",	
            "Q31H23B",	"Q31H23C",	"Q31H23D",	"Q31H23E",	"Q31H23F",	"Q31H23G",	
            "Q32JA34",	"Q33L2",	  "Q33L2A",	  "Q33L3F",	  "Q33L3G",	  "Q33L3H",		
            "Q33L10",   "Q33L10A",	"Q34LWPR",	"Q34PCPR",	"Q34BRPR",	"Q34APPR")

# Create Yearly Data Frames using Vectors
psid.data.68 <- psid.data[, colnames(psid.data) %in% list68]
psid.data.97 <- psid.data[, colnames(psid.data) %in% list97]
psid.data.02 <- psid.data[, colnames(psid.data) %in% list02]
psid.data.03 <- psid.data[, colnames(psid.data) %in% list03]
psid.data.07 <- psid.data[, colnames(psid.data) %in% list07]

# Map ID's Across Years via Map File

